{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Atualizar Embalagens - {{ item.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">
    <i class="fas fa-box-open me-2 text-primary"></i>
    Update Packing Data - <span>{{ item.name }}</span>
  </h3>

  <form method="post" class="compact-form"  novalidate>
    {% csrf_token %}
    {{ formset.management_form }}

    <!-- ðŸ”· VERSÃƒO ATUAL -->
    {% if current_forms %}
      <div class="card mb-4 border border-purple">
        <div class="card-header text-white" style="background-color: #6f42c1;">
          <i class="fas fa-check-circle me-2"></i>Current Version
        </div>
        <div class="card-body ">
          {% for form in current_forms %}
            {% crispy form %}
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- ðŸ“š HISTÃ“RICO -->
    <div class="accordion mb-4" id="historicAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingHist">
          <button class="accordion-button collapsed bg-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#collapseHist"
                  aria-expanded="false" aria-controls="collapseHist">
            History of Versions
          </button>
        </h2>
        <div id="collapseHist" class="accordion-collapse collapse"
             aria-labelledby="headingHist" data-bs-parent="#historicAccordion">
          <div class="accordion-body">
            {% if historic_forms %}
              {% for form in historic_forms %}
                <div class="card mb-3 border border-secondary">
                  <div class="card-header bg-light">
                    <strong>Verion of {{ form.instance.valid_from|date:"d/m/Y H:i" }}</strong>
                  </div>
                  <div class="card-body">
                    {% crispy form %}
                    {% if form.can_delete %}
                    <div class="form-check mt-2">
                      {{ form.DELETE }} <label>Excluir</label>
                    </div>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p class="text-muted mb-0">No old versions.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- âž• NOVA VERSÃƒO (accordion) -->
    <div class="accordion mb-4" id="newVersionAccordion">
      <div class="accordion-item border border-secondary">
        <h2 class="accordion-header" id="headingNew">
          <button class="accordion-button collapsed bg-secondary text-white" type="button"
                  data-bs-toggle="collapse" data-bs-target="#collapseNew"
                  aria-expanded="false" aria-controls="collapseNew"
                  style="box-shadow: none;">
            <i class="fas fa-plus-circle me-2"></i>New Version
          </button>
        </h2>
        <div id="collapseNew" class="accordion-collapse collapse"
            aria-labelledby="headingNew" data-bs-parent="#newVersionAccordion">
          <div class="accordion-body bg-light rounded-bottom">
            {% crispy empty_form %}
          </div>
        </div>
      </div>
    </div>

    <!-- AÃ‡Ã•ES -->
    <div class="text-end">
      <button type="submit" class="btn btn-success">
        <i class="fas fa-save me-1"></i>Save changes
      </button>
      <a href="{% url 'inventory:item-edit' item.pk %}" class="btn btn-secondary ms-2">
        <i class="fas fa-arrow-left me-1"></i>Voltar
      </a>
    </div>
  </form>
</div>
<style>
  .compact-form .form-group,
  .compact-form .mb-3 {
    margin-bottom: 0.5rem;
  }

  .compact-form .form-label {
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
  }

  .compact-form .form-control {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
    font-size: 0.875rem;
  }
</style>

{% endblock %}
